<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GrowSports LMS</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-storage.js"></script>
  <style>
    body { font-family: "Inter", sans-serif; }
    .green-theme { --color-primary: #16a34a; }
  </style>
</head>
<body class="bg-white text-gray-800 green-theme">
  <!-- Sidebar -->
  <div class="flex h-screen">
    <aside class="w-64 bg-green-600 text-white flex flex-col">
      <div class="p-4 text-2xl font-bold border-b border-green-500">
        GrowSports LMS
      </div>
      <nav class="flex-1 p-4 space-y-2">
        <button onclick="showSection('dashboard')" class="w-full text-left p-2 rounded hover:bg-green-700">üè† Dashboard</button>
        <button onclick="showSection('courses')" class="w-full text-left p-2 rounded hover:bg-green-700">üìö Courses</button>
        <button onclick="showSection('profile')" class="w-full text-left p-2 rounded hover:bg-green-700">üë§ Profile</button>
        <button onclick="showSection('admin')" class="w-full text-left p-2 rounded hover:bg-green-700">üõ† Admin Panel</button>
      </nav>
      <div class="p-4 border-t border-green-500">
        <button onclick="logout()" class="w-full bg-red-500 hover:bg-red-600 p-2 rounded">üö™ Logout</button>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 overflow-y-auto p-6 space-y-8">
      <!-- Dashboard -->
      <section id="dashboard" class="hidden">
        <h2 class="text-2xl font-bold text-green-700 mb-4">My Dashboard</h2>
        <div id="dashboardContent" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          <!-- Course progress cards -->
        </div>
      </section>

      <!-- Courses -->
      <section id="courses" class="hidden">
        <h2 class="text-2xl font-bold text-green-700 mb-4">Course Library</h2>
        <div id="courseLibrary" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          <!-- Course cards -->
        </div>
      </section>

      <!-- Profile -->
      <section id="profile" class="hidden">
        <h2 class="text-2xl font-bold text-green-700 mb-4">My Profile</h2>
        <div class="bg-white shadow rounded p-6 max-w-md">
          <img id="profilePic" class="w-24 h-24 rounded-full mb-4" src="" alt="Profile Picture"/>
          <p><strong>Email:</strong> <span id="profileEmail"></span></p>
          <p><strong>Name:</strong> <span id="profileName"></span></p>
          <textarea id="profileBio" class="w-full border p-2 mt-2 rounded" placeholder="Add a short bio..."></textarea>
          <button onclick="updateProfile()" class="mt-3 bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">Save Profile</button>
        </div>
      </section>

      <!-- Admin Panel -->
      <section id="admin" class="hidden">
        <h2 class="text-2xl font-bold text-green-700 mb-4">Admin Panel</h2>
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <!-- Add Course -->
          <div class="bg-white shadow p-6 rounded">
            <h3 class="text-xl font-semibold mb-3">Add Course</h3>
            <input id="courseTitle" type="text" placeholder="Course Title" class="w-full border p-2 rounded mb-2"/>
            <textarea id="courseDescription" placeholder="Course Description" class="w-full border p-2 rounded mb-2"></textarea>
            <input id="courseImage" type="file" class="mb-2"/>
            <button onclick="addCourse()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">Add Course</button>
          </div>

          <!-- Add Module -->
          <div class="bg-white shadow p-6 rounded">
            <h3 class="text-xl font-semibold mb-3">Add Module</h3>
            <input id="moduleCourseId" type="text" placeholder="Course ID" class="w-full border p-2 rounded mb-2"/>
            <input id="moduleTitle" type="text" placeholder="Module Title" class="w-full border p-2 rounded mb-2"/>
            <button onclick="addModule()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">Add Module</button>
          </div>
        </div>

        <!-- Add Subject/Topic -->
        <div class="bg-white shadow p-6 rounded mt-6">
          <h3 class="text-xl font-semibold mb-3">Add Subject/Topic</h3>
          <input id="topicCourseId" type="text" placeholder="Course ID" class="w-full border p-2 rounded mb-2"/>
          <input id="topicModuleId" type="text" placeholder="Module ID" class="w-full border p-2 rounded mb-2"/>
          <input id="topicTitle" type="text" placeholder="Topic Title" class="w-full border p-2 rounded mb-2"/>
          <input id="topicVideo" type="url" placeholder="Video Link (YouTube/Vimeo/GDrive)" class="w-full border p-2 rounded mb-2"/>
          <input id="topicNotes" type="url" placeholder="Notes Link (Google Drive/PDF)" class="w-full border p-2 rounded mb-2"/>
          <button onclick="addTopic()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">Add Topic</button>
        </div>
      </section>
    </main>
  </div>

  <script type="module">
    // --- Firebase Config ---
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.11/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.6.11/firebase-auth.js";
    import { getFirestore, collection, addDoc, doc, setDoc, getDocs } from "https://www.gstatic.com/firebasejs/9.6.11/firebase-firestore.js";
    import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.6.11/firebase-storage.js";

    const firebaseConfig = {
      apiKey: "YOUR_API_KEY_HERE",
      authDomain: "YOUR_AUTH_DOMAIN_HERE",
      projectId: "YOUR_PROJECT_ID_HERE",
      storageBucket: "YOUR_STORAGE_BUCKET_HERE",
      messagingSenderId: "YOUR_MSG_SENDER_ID_HERE",
      appId: "YOUR_APP_ID_HERE"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const storage = getStorage(app);

    // --- Auth & Profile ---
    onAuthStateChanged(auth, user => {
      if (user) {
        document.getElementById("profileEmail").innerText = user.email;
        document.getElementById("profileName").innerText = user.displayName || "Anonymous";
        document.getElementById("profilePic").src = user.photoURL || "https://via.placeholder.com/100";
        showSection("dashboard");
      } else {
        alert("Please log in!");
      }
    });

    function logout() { signOut(auth); }

    async function updateProfile() {
      const bio = document.getElementById("profileBio").value;
      await setDoc(doc(db, "profiles", auth.currentUser.uid), { bio }, { merge: true });
      alert("Profile updated!");
    }

    // --- Admin: Add Course ---
    async function addCourse() {
      const title = document.getElementById("courseTitle").value;
      const desc = document.getElementById("courseDescription").value;
      const file = document.getElementById("courseImage").files[0];
      let imageUrl = "";
      if (file) {
        const storageRef = ref(storage, "courseImages/" + file.name);
        await uploadBytes(storageRef, file);
        imageUrl = await getDownloadURL(storageRef);
      }
      await addDoc(collection(db, "courses"), { title, desc, imageUrl });
      alert("Course added!");
    }

    // --- Admin: Add Module ---
    async function addModule() {
      const courseId = document.getElementById("moduleCourseId").value;
      const title = document.getElementById("moduleTitle").value;
      await addDoc(collection(db, "courses", courseId, "modules"), { title });
      alert("Module added!");
    }

    // --- Admin: Add Topic ---
    async function addTopic() {
      const courseId = document.getElementById("topicCourseId").value;
      const moduleId = document.getElementById("topicModuleId").value;
      const title = document.getElementById("topicTitle").value;
      const video = document.getElementById("topicVideo").value;
      const notes = document.getElementById("topicNotes").value;
      await addDoc(collection(db, "courses", courseId, "modules", moduleId, "topics"), { title, video, notes });
      alert("Topic added!");
    }

    // --- UI Section Switch ---
    function showSection(id) {
      document.querySelectorAll("main section").forEach(sec => sec.classList.add("hidden"));
      document.getElementById(id).classList.remove("hidden");
    }
    window.showSection = showSection;
    window.logout = logout;
    window.updateProfile = updateProfile;
    window.addCourse = addCourse;
    window.addModule = addModule;
    window.addTopic = addTopic;
  </script>
</body>
</html>
